# è¯­éŸ³é€šè¯åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½ç‰¹æ€§

### âœ¨ æ–°å¢æ”¹è¿›

1. **éº¦å…‹é£æƒé™æ£€æµ‹**
   - è‡ªåŠ¨æ£€æµ‹éº¦å…‹é£è®¾å¤‡
   - å‹å¥½çš„æƒé™æç¤ºä¿¡æ¯
   - è¯¦ç»†çš„é”™è¯¯è¯Šæ–­

2. **æ”¹è¿›çš„é€šè¯ç•Œé¢**
   - æ˜¾ç¤ºå¯¹æ–¹åç§°ï¼ˆå‘¼å«æ–¹/æ¥å¬æ–¹è‡ªåŠ¨è¯†åˆ«ï¼‰
   - å®æ—¶é€šè¯æ—¶é•¿æ˜¾ç¤ºï¼ˆMM:SSæ ¼å¼ï¼‰
   - é€šè¯ç±»å‹æ ‡è¯†ï¼ˆğŸ“ å•äººé€šè¯ / ğŸ‘¥ ç¾¤èŠè¯­éŸ³ï¼‰
   - åŠ¨æ€çŠ¶æ€æ›´æ–°ï¼ˆå‘¼å«ä¸­ã€å“é“ƒä¸­ã€é€šè¯ä¸­ï¼‰
   - ç°ä»£åŒ–UIè®¾è®¡

3. **æ™ºèƒ½é€šè¯ç®¡ç†**
   - å‘¼å«æ—¶è‡ªåŠ¨æ‰“å¼€é€šè¯æ§åˆ¶çª—å£
   - æ¥å¬åè‡ªåŠ¨æ˜¾ç¤ºé€šè¯ç•Œé¢
   - çª—å£å…³é—­æ—¶è‡ªåŠ¨æŒ‚æ–­é€šè¯

## ç•Œé¢é¢„è§ˆ

### è¯­éŸ³é€šè¯æ§åˆ¶çª—å£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ“ è¯­éŸ³é€šè¯            â”‚
â”‚                             â”‚
â”‚        å¯¹æ–¹ç”¨æˆ·å           â”‚
â”‚                             â”‚
â”‚       é€šè¯ä¸­ âœ“              â”‚
â”‚       05:32                 â”‚
â”‚                             â”‚
â”‚      ğŸ“µ æŒ‚æ–­                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¾¤èŠè¯­éŸ³çª—å£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ‘¥ ç¾¤èŠè¯­éŸ³            â”‚
â”‚                             â”‚
â”‚      å¼€å‘ç»„è®¨è®ºç¾¤           â”‚
â”‚                             â”‚
â”‚       é€šè¯ä¸­ âœ“              â”‚
â”‚       02:15                 â”‚
â”‚                             â”‚
â”‚      ğŸ“µ æŒ‚æ–­                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨æ­¥éª¤

### 1. å‘èµ·åŒäººè¯­éŸ³é€šè¯

**æ­¥éª¤ï¼š**
1. é€‰æ‹©è¦é€šè¯çš„ç”¨æˆ·ï¼ˆåœ¨åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ä¸­åŒå‡»æˆ–æ‰‹åŠ¨è¾“å…¥ï¼‰
2. ç¡®ä¿"å‘é€è‡³"é€‰é¡¹ä¸º"ç§èŠ"
3. ç‚¹å‡»"ğŸ“ è¯­éŸ³é€šè¯"æŒ‰é’®
4. ç­‰å¾…å¯¹æ–¹æ¥å¬
5. é€šè¯æ§åˆ¶çª—å£ä¼šè‡ªåŠ¨æ‰“å¼€ï¼Œæ˜¾ç¤ºå‘¼å«çŠ¶æ€

**ç•Œé¢ä¿¡æ¯ï¼š**
- é¡¶éƒ¨æ˜¾ç¤ºé€šè¯ç±»å‹ï¼ˆğŸ“ è¯­éŸ³é€šè¯ï¼‰
- ä¸­é—´æ˜¾ç¤ºå¯¹æ–¹ç”¨æˆ·å
- æ˜¾ç¤ºå½“å‰çŠ¶æ€ï¼ˆå‘¼å«ä¸­... / å“é“ƒä¸­... / é€šè¯ä¸­ï¼‰
- æœªæ¥é€šæ—¶æ˜¾ç¤º"ç­‰å¾…æ¥å¬..."
- æ¥é€šåæ˜¾ç¤ºå®æ—¶é€šè¯æ—¶é•¿ï¼ˆæ ¼å¼ï¼šMM:SSï¼‰

### 2. å‘èµ·ç¾¤èŠè¯­éŸ³é€šè¯

**æ­¥éª¤ï¼š**
1. é€‰æ‹©è¦é€šè¯çš„ç¾¤èŠæˆ¿é—´
2. å°†"å‘é€è‡³"é€‰é¡¹åˆ‡æ¢ä¸º"æˆ¿é—´"
3. è¾“å…¥æˆ¿é—´IDï¼ˆæˆ–ä»æˆ¿é—´åˆ—è¡¨é€‰æ‹©ï¼‰
4. ç‚¹å‡»"ğŸ“ è¯­éŸ³é€šè¯"æŒ‰é’®
5. ç¾¤å†…æ‰€æœ‰æˆå‘˜ä¼šæ”¶åˆ°æ¥ç”µæç¤º

**ç‰¹ç‚¹ï¼š**
- æ”¯æŒå¤šäººåŒæ—¶åœ¨çº¿
- æ˜¾ç¤ºé€šè¯ç±»å‹ä¸º"ğŸ‘¥ ç¾¤èŠè¯­éŸ³"
- æˆå‘˜å¯ä»¥åŠ¨æ€åŠ å…¥å’Œé€€å‡º

### 3. æ¥å¬æ¥ç”µ

**æ¥ç”µæç¤ºçª—å£ï¼š**
- æ˜¾ç¤ºæ¥ç”µä¿¡æ¯ï¼š"ğŸ“ æ¥è‡ª [ç”¨æˆ·å] çš„[è¯­éŸ³é€šè¯/ç¾¤èŠè¯­éŸ³]"
- ä¸¤ä¸ªæŒ‰é’®ï¼š
  - âœ… æ¥å¬ï¼šæ¥å¬é€šè¯å¹¶å¼€å§‹è¯­éŸ³
  - âŒ æ‹’ç»ï¼šæ‹’ç»æ­¤æ¬¡é€šè¯

**æ¥å¬åï¼š**
- è‡ªåŠ¨æ‰“å¼€é€šè¯æ§åˆ¶çª—å£
- æ˜¾ç¤ºå¯¹æ–¹åç§°
- å¼€å§‹å®æ—¶è®¡æ—¶
- çŠ¶æ€å˜ä¸º"é€šè¯ä¸­"

### 4. é€šè¯ä¸­åŠŸèƒ½

**å®æ—¶ä¿¡æ¯æ›´æ–°ï¼š**
- é€šè¯æ—¶é•¿æ¯ç§’æ›´æ–°
- çŠ¶æ€å®æ—¶æ˜¾ç¤º
- çª—å£å¯ä»¥æœ€å°åŒ–ä½†é€šè¯ç»§ç»­

**æŒ‚æ–­é€šè¯ï¼š**
- ç‚¹å‡»"ğŸ“µ æŒ‚æ–­"æŒ‰é’®
- æˆ–ç›´æ¥å…³é—­é€šè¯æ§åˆ¶çª—å£
- é€šè¯ç«‹å³ç»“æŸï¼Œé‡Šæ”¾éŸ³é¢‘èµ„æº

## éº¦å…‹é£æƒé™

### Windows ç³»ç»Ÿ

é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå¼¹å‡ºéº¦å…‹é£æƒé™è¯·æ±‚ï¼š
1. å…è®¸åº”ç”¨è®¿é—®éº¦å…‹é£
2. ç¡®ä¿éº¦å…‹é£è®¾å¤‡å·²æ­£ç¡®è¿æ¥
3. æ£€æŸ¥ç³»ç»Ÿå£°éŸ³è®¾ç½®ä¸­çš„éº¦å…‹é£æ˜¯å¦å¯ç”¨

### æƒé™æ£€æŸ¥

å¦‚æœé‡åˆ°éº¦å…‹é£è®¿é—®é—®é¢˜ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š
```
æ— æ³•è®¿é—®éº¦å…‹é£ã€‚è¯·æ£€æŸ¥ï¼š
1. éº¦å…‹é£è®¾å¤‡æ˜¯å¦è¿æ¥
2. æ˜¯å¦æˆäºˆäº†éº¦å…‹é£æƒé™
3. éº¦å…‹é£æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨
```

### æ•…éšœæ’é™¤

**é—®é¢˜ï¼šæ— æ³•å¯åŠ¨é€šè¯**
- æ£€æŸ¥æ˜¯å¦å®‰è£…äº† pyaudioï¼š`pip install pyaudio`
- ç¡®è®¤éº¦å…‹é£è®¾å¤‡åœ¨ç³»ç»Ÿä¸­å¯è§
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç¨‹åºå ç”¨éº¦å…‹é£

**é—®é¢˜ï¼šå¬ä¸åˆ°å£°éŸ³**
- æ£€æŸ¥æ‰¬å£°å™¨éŸ³é‡
- ç¡®è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡æ­£ç¡®
- æ£€æŸ¥ç³»ç»Ÿå£°éŸ³è®¾ç½®

**é—®é¢˜ï¼šå¯¹æ–¹å¬ä¸åˆ°æˆ‘çš„å£°éŸ³**
- æ£€æŸ¥éº¦å…‹é£æ˜¯å¦é™éŸ³
- æµ‹è¯•éº¦å…‹é£åœ¨å…¶ä»–åº”ç”¨ä¸­æ˜¯å¦å·¥ä½œ
- é‡å¯åº”ç”¨é‡æ–°è¯·æ±‚éº¦å…‹é£æƒé™

## æŠ€æœ¯ç»†èŠ‚

### éŸ³é¢‘é…ç½®
- **é‡‡æ ·ç‡**ï¼š48000 Hz
- **å£°é“**ï¼šå•å£°é“ï¼ˆMonoï¼‰
- **å¸§é•¿**ï¼š20ms
- **ç¼–ç **ï¼šOpusï¼ˆå¦‚æœå¯ç”¨ï¼‰æˆ– PCM

### é€šè¯æ—¶é•¿è®¡ç®—
- å¼€å§‹è®¡æ—¶ï¼šé€šè¯æ¥é€šæ—¶ï¼ˆ`connect_time`ï¼‰
- æ›´æ–°é¢‘ç‡ï¼šæ¯ç§’æ›´æ–°ä¸€æ¬¡
- æ˜¾ç¤ºæ ¼å¼ï¼šMM:SSï¼ˆåˆ†é’Ÿ:ç§’ï¼‰
- ç­‰å¾…é˜¶æ®µï¼šæ˜¾ç¤º"ç­‰å¾…æ¥å¬..."æˆ–ç­‰å¾…æ—¶é•¿

### é€šè¯çŠ¶æ€
1. **calling** - å‘¼å«ä¸­ï¼ˆå‘èµ·æ–¹ï¼‰
2. **ringing** - å“é“ƒä¸­ï¼ˆç­‰å¾…æ¥å¬ï¼‰
3. **incoming** - æ¥ç”µï¼ˆæ¥æ”¶æ–¹ï¼‰
4. **connected** - é€šè¯ä¸­ï¼ˆå·²æ¥é€šï¼‰
5. **ended** - å·²ç»“æŸ

## æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œå»¶è¿Ÿ**ï¼šå»ºè®®åœ¨ä½å»¶è¿Ÿç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œå»¶è¿Ÿè¿‡é«˜ä¼šå½±å“é€šè¯è´¨é‡
2. **éŸ³é¢‘è®¾å¤‡**ï¼šç¡®ä¿éº¦å…‹é£å’Œæ‰¬å£°å™¨è®¾å¤‡å¯ç”¨ä¸”æœªè¢«å…¶ä»–ç¨‹åºå ç”¨
3. **ç³»ç»Ÿæƒé™**ï¼šé¦–æ¬¡ä½¿ç”¨æ—¶éœ€è¦æˆäºˆéº¦å…‹é£è®¿é—®æƒé™
4. **é€šè¯çª—å£**ï¼šå…³é—­é€šè¯æ§åˆ¶çª—å£ä¼šè‡ªåŠ¨æŒ‚æ–­é€šè¯
5. **èµ„æºå ç”¨**ï¼šè¯­éŸ³é€šè¯ä¼šå ç”¨CPUå’Œç½‘ç»œå¸¦å®½

## å¿«æ·æ“ä½œ

- **å¿«é€Ÿå‘¼å«**ï¼šåŒå‡»åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ä¸­çš„ç”¨æˆ·åï¼Œç„¶åç‚¹å‡»è¯­éŸ³é€šè¯æŒ‰é’®
- **å¿«é€ŸæŒ‚æ–­**ï¼šå…³é—­é€šè¯æ§åˆ¶çª—å£æˆ–ç‚¹å‡»æŒ‚æ–­æŒ‰é’®
- **æŸ¥çœ‹æ—¶é•¿**ï¼šé€šè¯æ§åˆ¶çª—å£å®æ—¶æ˜¾ç¤ºé€šè¯æ—¶é•¿
- **æœ€å°åŒ–çª—å£**ï¼šå¯ä»¥æœ€å°åŒ–é€šè¯æ§åˆ¶çª—å£ï¼Œé€šè¯ç»§ç»­è¿›è¡Œ

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯1ï¼šåŒäººè¯­éŸ³é€šè¯
```
ç”¨æˆ·A -> ç‚¹å‡»"ğŸ“ è¯­éŸ³é€šè¯"
      -> é€šè¯æ§åˆ¶çª—å£æ‰“å¼€ï¼Œæ˜¾ç¤º"å‘¼å«ä¸­..."
      -> å¼€å§‹è®¡æ—¶ç­‰å¾…æ—¶é•¿

ç”¨æˆ·B -> æ”¶åˆ°æ¥ç”µæç¤ºçª—å£
      -> ç‚¹å‡»"âœ… æ¥å¬"
      -> é€šè¯æ§åˆ¶çª—å£æ‰“å¼€

åŒæ–¹  -> çŠ¶æ€å˜ä¸º"é€šè¯ä¸­"
      -> å¼€å§‹æ˜¾ç¤ºé€šè¯æ—¶é•¿ï¼ˆ00:00, 00:01, 00:02...ï¼‰
      -> å¯ä»¥è¿›è¡Œè¯­éŸ³äº¤æµ

ä»»ä¸€æ–¹ -> ç‚¹å‡»"ğŸ“µ æŒ‚æ–­"
       -> é€šè¯ç»“æŸ
       -> çª—å£å…³é—­
```

### åœºæ™¯2ï¼šç¾¤èŠè¯­éŸ³é€šè¯
```
ç”¨æˆ·A -> é€‰æ‹©ç¾¤èŠæˆ¿é—´
      -> ç‚¹å‡»"ğŸ“ è¯­éŸ³é€šè¯"
      -> ç¾¤å†…æ‰€æœ‰æˆå‘˜æ”¶åˆ°æ¥ç”µ

ç”¨æˆ·B,C,D -> é€‰æ‹©æ¥å¬æˆ–æ‹’ç»
           -> æ¥å¬çš„æˆå‘˜åŠ å…¥é€šè¯

æ‰€æœ‰æˆå‘˜ -> é€šè¯æ§åˆ¶çª—å£æ˜¾ç¤º"ğŸ‘¥ ç¾¤èŠè¯­éŸ³"
        -> æ˜¾ç¤ºæˆ¿é—´åç§°
        -> å®æ—¶æ˜¾ç¤ºé€šè¯æ—¶é•¿
        -> å¯ä»¥éšæ—¶æŒ‚æ–­é€€å‡º
```

## å¼€å‘è€…ä¿¡æ¯

é€šè¯çŠ¶æ€å­˜å‚¨åœ¨ `VoiceManager.current_call` ä¸­ï¼š
```python
{
    "call_id": "unique-call-id",
    "target_id": "target-user-or-room",
    "from_user": "caller-username",  # æ¥å¬æ–¹ä¼šæœ‰æ­¤å­—æ®µ
    "call_type": "direct" | "group",
    "status": "calling" | "ringing" | "connected" | "ended",
    "is_initiator": True | False,
    "start_time": 1234567890.123,  # é€šè¯å‘èµ·æ—¶é—´
    "connect_time": 1234567895.456 # é€šè¯æ¥é€šæ—¶é—´ï¼ˆå¯èƒ½ä¸ºNoneï¼‰
}
```
